(this["webpackJsonplogin-api"]=this["webpackJsonplogin-api"]||[]).push([[0],{25:function(t,e,n){},45:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n(2),i=n.n(a),s=n(18),c=n.n(s),o=(n(25),n(3)),u=n(4),d=n(6),l=n(5),b=function(t){Object(d.a)(n,t);var e=Object(l.a)(n);function n(t){var r;return Object(o.a)(this,n),(r=e.call(this,t)).state={disabled:!1},r}return Object(u.a)(n,[{key:"submitHandler",value:function(t){var e=this;t.preventDefault(),this.setState({disabled:!0}),this.props.client.login(t.target.username.value,t.target.password.value).then((function(t){e.setState({disabled:!1}),e.props.loggedIn(t.data.token)})).catch((function(){alert("an error occured, please try again"),e.setState({disabled:!1})}))}},{key:"render",value:function(){var t=this;return Object(r.jsxs)(r.Fragment,{children:["Login",Object(r.jsx)("br",{}),Object(r.jsxs)("form",{onSubmit:function(e){return t.submitHandler(e)},children:["username",Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"text",name:"username",disabled:this.state.disabled}),Object(r.jsx)("br",{}),"password",Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"password",name:"password",disabled:this.state.disabled}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)("button",{type:"submit",disabled:this.state.disabled,children:" Submit "})]})]})}}]),n}(i.a.Component),h=function(t){Object(d.a)(n,t);var e=Object(l.a)(n);function n(t){var r;return Object(o.a)(this,n),(r=e.call(this,t)).state={disabled:!1},r}return Object(u.a)(n,[{key:"submitHandler",value:function(t){var e,n=this;t.preventDefault(),this.setState({disabled:!0}),e=this.props.currentAd?this.props.client.updateAd(this.props.currentAd._id,t.target.adName.value,t.target.price.value):this.props.client.addAd(t.target.adName.value,t.target.price.value),console.log(e),e.then((function(){n.setState({disabled:!1}),document.getElementById("addForm").reset(),n.props.refreshList()})).catch((function(){console.log("catch"),alert("an error occured, please try again"),n.setState({disabled:!1})}))}},{key:"render",value:function(){var t,e,n=this;return console.log(this.props.currentAd),Object(r.jsxs)(r.Fragment,{children:[this.props.currentAd?"Update":"Add",Object(r.jsx)("br",{}),Object(r.jsxs)("form",{onSubmit:function(t){return n.submitHandler(t)},id:"addForm",children:["Name: ",Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"text",defaultValue:null===(t=this.props.currentAd)||void 0===t?void 0:t.name,name:"adName",disabled:this.state.disabled}),Object(r.jsx)("br",{}),"Price:",Object(r.jsx)("br",{}),Object(r.jsx)("input",{type:"text",defaultValue:null===(e=this.props.currentAd)||void 0===e?void 0:e.price,name:"price",disabled:this.state.disabled}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)("button",{type:"submit",disabled:this.state.disabled,children:" Submit "})]})]})}}]),n}(i.a.Component),j=function(t){Object(d.a)(n,t);var e=Object(l.a)(n);function n(t){var r;return Object(o.a)(this,n),(r=e.call(this,t)).state={ads:[],currentAd:void 0},r}return Object(u.a)(n,[{key:"refreshList",value:function(){var t=this;this.props.client.getAds().then((function(e){return t.setState({ads:e.data})}))}},{key:"removeAdvert",value:function(t){var e=this;this.props.client.removeAd(t).then((function(){return e.refreshList()}))}},{key:"updateAdvert",value:function(t){this.setState({currentAd:t})}},{key:"componentDidMount",value:function(){this.refreshList()}},{key:"buildrows",value:function(){var t=this;return this.state.ads.map((function(e){return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:e.name}),Object(r.jsxs)("td",{children:["\xa3",e.price]}),Object(r.jsxs)("td",{children:[Object(r.jsx)("button",{onClick:function(){return t.removeAdvert(e._id)},children:" remove"}),Object(r.jsx)("button",{onClick:function(){return t.updateAdvert(e)},children:" update"})]})]},e._id)}))}},{key:"render",value:function(){var t=this;return Object(r.jsxs)(r.Fragment,{children:["Dashboard",Object(r.jsx)("br",{}),Object(r.jsxs)("table",{children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"Advert Name"}),Object(r.jsx)("th",{children:"Price"})]})}),Object(r.jsx)("tbody",{children:this.buildrows()})]}),Object(r.jsx)("br",{}),Object(r.jsx)("br",{}),Object(r.jsx)(h,{client:this.props.client,refreshList:function(){t.refreshList(),t.setState({currentAd:void 0})},currentAd:this.state.currentAd}),Object(r.jsx)("button",{onClick:function(){return t.props.client.logoutHandler()},children:"logout"})]})}}]),n}(i.a.Component),p=n(8),v=n.n(p),f=n(19),O=n(9),m=n.n(O),x=" https://authorisation-training-api.herokuapp.com/",g=function(){function t(e,n){Object(o.a)(this,t),this.tokenProvider=e,this.logoutHandler=n}return Object(u.a)(t,[{key:"login",value:function(){var t=Object(f.a)(v.a.mark((function t(e,n){return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m()({method:"post",url:"".concat(x,"auth"),data:{username:e,password:n}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"authenticatedCall",value:function(t,e,n){var r=this;return m()({method:t,url:e,headers:{authorization:this.tokenProvider()},data:n}).catch((function(t){if(403===t.response.status)return r.logoutHandler(),Promise.reject();throw t}))}},{key:"getAds",value:function(){return this.authenticatedCall("get",x)}},{key:"addAd",value:function(t,e){return this.authenticatedCall("post",x,{name:t,price:e})}},{key:"removeAd",value:function(t){return this.authenticatedCall("delete","".concat(x).concat(t))}},{key:"updateAd",value:function(t,e,n){return this.authenticatedCall("put","".concat(x).concat(t),{name:e,price:n})}}]),t}(),k=function(t){Object(d.a)(n,t);var e=Object(l.a)(n);function n(t){var r;return Object(o.a)(this,n),(r=e.call(this,t)).state={token:window.localStorage.getItem("token")},r.client=new g((function(){return r.state.token}),(function(){return r.logout()})),r}return Object(u.a)(n,[{key:"login",value:function(t){window.localStorage.setItem("token",t),this.setState({token:t})}},{key:"logout",value:function(){window.localStorage.removeItem("token"),this.setState({token:void 0})}},{key:"render",value:function(){var t=this;return this.state.token?Object(r.jsx)(j,{client:this.client}):Object(r.jsx)(b,{loggedIn:function(e){return t.login(e)},client:this.client})}}]),n}(i.a.Component),y=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,46)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,i=e.getLCP,s=e.getTTFB;n(t),r(t),a(t),i(t),s(t)}))};c.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(k,{})}),document.getElementById("root")),y()}},[[45,1,2]]]);
//# sourceMappingURL=main.d51f75fc.chunk.js.map